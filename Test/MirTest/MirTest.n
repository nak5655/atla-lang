using Nemerle;
using Nemerle.Collections;
using Nemerle.Text;
using Nemerle.Utility;

using System;
using System.Collections.Generic;
using System.Linq;

using NUnit.Framework;

using Atla.Lang.Mir;

namespace Test.MirTest
{
    [TestFixture]
    class MirTest
    {
        [Test]
        public MirEasyTest(): void {
            def asm = Atla.Lang.Hir.Assembly("Test", Misc.tempFile("MirTest.exe"));
            asm.scope = Atla.Lang.Hir.Scope.Assembly(Atla.Lang.Hir.Scope.Global(), asm.name);
            
            def code = Misc.readCase("hello.atla");
            _ = Misc.compiler.updateModule(asm, "main", code);
            Misc.compiler.compileHirToThir(asm);
            def _mir = Misc.compiler.compileHirToMir(asm);
            def mir = _mir.Value.modules["main"];
        }
        
        [Test]
        public MirFibonacciTest(): void {
            def asm = Atla.Lang.Hir.Assembly("Test", Misc.tempFile("MirTest.exe"));
            asm.scope = Atla.Lang.Hir.Scope.Assembly(Atla.Lang.Hir.Scope.Global(), asm.name);
            
            def code = Misc.readCase("fibonacci.atla");
            _ = Misc.compiler.updateModule(asm, "main", code);
            Misc.compiler.compileHirToThir(asm);
            def _mir = Misc.compiler.compileHirToMir(asm);
            def mir = _mir.Value.modules["main"];
        }
        
        [Test]
        public MirGeometryTest(): void {
            def asm = Atla.Lang.Hir.Assembly("Test", Misc.tempFile("MirTest.exe"));
            asm.scope = Atla.Lang.Hir.Scope.Assembly(Atla.Lang.Hir.Scope.Global(), asm.name);
            
            def code = Misc.readCase("geometry.atla");
            _ = Misc.compiler.updateModule(asm, "main", code);
            Misc.compiler.compileHirToThir(asm);
            def _mir = Misc.compiler.compileHirToMir(asm);
            def mir = _mir.Value.modules["main"];
        }
        
        [Test]
        public MirCountUpTest(): void {
            def asm = Atla.Lang.Hir.Assembly("Test", Misc.tempFile("MirTest.exe"));
            asm.scope = Atla.Lang.Hir.Scope.Assembly(Atla.Lang.Hir.Scope.Global(), asm.name);
            
            def code = Misc.readCase("countup.atla");
            _ = Misc.compiler.updateModule(asm, "main", code);
            Misc.compiler.compileHirToThir(asm);
            def _mir = Misc.compiler.compileHirToMir(asm);
            def mir = _mir.Value.modules["main"];
        }
    }
}
